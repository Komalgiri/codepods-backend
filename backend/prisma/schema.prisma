generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// ///////////////////////
/// ///////////////////////
model User {
  id               String      @id @default(cuid())
  email            String?     @unique
  name             String?
  createdAt        DateTime    @default(now())
  password         String?
  githubId         String?     @unique
  githubToken      String?
  role             String      @default("user")
  githubUsername   String?     @unique
  inferredRole     String?
  techStack        String[]    @default([])
  githubTokenValid Boolean     @default(true)
  roleAnalysis     Json?
  reliabilityScore Float       @default(100.0)
  dynamicsMetrics  Json?
  activities       Activity[]
  pods             PodMember[]
  rewards          Reward[]
  tasks            Task[]
  skills           Skill[]     @relation("UserSkills")
}

/// ///////////////////////
/// ///////////////////////
model Pod {
  id               String      @id @default(cuid())
  name             String
  description      String?
  createdAt        DateTime    @default(now())
  repoName         String?
  repoOwner        String?
  aiRoadmap        Json?
  roadmapUpdatedAt DateTime?
  projectBrain     Json?
  activities       Activity[]
  members          PodMember[]
  tasks            Task[]
}

model PodMember {
  id     String @id @default(cuid())
  userId String
  podId  String
  role   String
  status String @default("accepted")
  pod    Pod    @relation(fields: [podId], references: [id])
  user   User   @relation(fields: [userId], references: [id])

  @@unique([userId, podId])
}

/// ///////////////////////
/// ///////////////////////
model Task {
  id                 String    @id @default(cuid())
  title              String
  status             String    @default("pending")
  podId              String
  assignedTo         String?
  createdAt          DateTime  @default(now())
  dueAt              DateTime?
  description        String?
  completedAt        DateTime?
  originalAssigneeId String?
  user               User?     @relation(fields: [assignedTo], references: [id])
  pod                Pod       @relation(fields: [podId], references: [id])
}

/// ///////////////////////
/// ///////////////////////
model Activity {
  id        String   @id @default(cuid())
  type      String
  meta      Json?
  value     Int      @default(0)
  userId    String
  podId     String?
  createdAt DateTime @default(now())
  pod       Pod?     @relation(fields: [podId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  sourceId  String?   // add this


}

model Reward {
  id        String   @id @default(cuid())
  points    Int      @default(0)
  reason    String?
  userId    String
  createdAt DateTime @default(now())
  badges    String[]
  user      User     @relation(fields: [userId], references: [id])
}

model Badge {
  id          String  @id @default(cuid())
  slug        String  @unique
  title       String
  description String
  icon        String?
  points      Int
}

/// ///////////////////////
/// ///////////////////////
model Skill {
  id    String @id @default(cuid())
  name  String @unique
  users User[] @relation("UserSkills")
}
